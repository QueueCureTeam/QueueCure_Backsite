<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Callback</title>
</head>
<body>
  <h2>Processing login...</h2>

  <script>
     const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    if (code) {
      fetch("/auth/callback", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code })
      })
      .then(res => res.json())
      .then(tokens => {
        localStorage.setItem("id_token", tokens.id_token);
        localStorage.setItem("access_token", tokens.access_token);
        window.location.href = "/login.html"; // กลับไปหน้า login หรือ home
      })
      .catch(err => {
        document.body.innerHTML = "Error: " + err.message;
      });
    } else {
      document.body.innerHTML = "No code found in URL";
    }
  </script>
</body>
</html>
